# 신고(reports) / 승인(approvals) 테이블 분석

> 작성일: 2026-01-29
> 목적: ERD vs 프론트엔드 구조 비교 및 설계 이슈 도출

---

## 1. 신고(reports) 테이블

### 1.1 현재 ERD 구조

```
reports
├── report_id (PK)
├── reporter_type: STORE, RIDER, CUSTOMER     ← 신고자 유형
├── reporter_id                                ← 신고자 ID
├── target_type: STORE, RIDER, REVIEW, CUSTOMER  ← 피신고 대상 유형
├── target_id                                  ← 피신고 대상 ID
├── reason_detail                              ← 상세 사유
├── status: PENDING, PROCESSING, RESOLVED, DISMISSED
├── admin_note                                 ← 관리자 메모
├── resolved_at                                ← 처리 완료일시
├── created_at
└── updated_at
```

### 1.2 프론트엔드 실제 사용 구조 (AdminDashboard.jsx)

```javascript
{
  id: 1,
  type: '배송지연',                    // ← ERD에 없음: 신고 유형 분류
  status: '확인 중',                   // PENDING/PROCESSING/RESOLVED/DISMISSED
  time: '1시간 전',                    // created_at
  content: '예상 시간보다 30분이나 늦게 도착했습니다.',  // reason_detail
  orderNo: 'ORD-20260127-001',        // ← ERD에 없음: 관련 주문번호
  reporter: {                          // reporter_type + reporter_id
    type: 'USER',
    name: '김서연',
    contact: '010-1111-2222'
  },
  reported: {                          // target_type + target_id
    type: 'STORE',
    name: '무림 정육점',
    contact: '010-2222-3333'
  },
  resolution: '...'                    // admin_note와 유사하지만 별도
}
```

### 1.3 필드 매핑 비교

| 프론트 필드 | ERD 컬럼 | 상태 | 비고 |
|-----------|---------|------|------|
| id | report_id | 매핑됨 | |
| type | - | **ERD 누락** | 신고 유형 (배송지연, 상품불량, 불친절, 정산문제) |
| status | status | 값 불일치 | 확인중↔PENDING, 처리완료↔RESOLVED |
| time | created_at | 매핑됨 | 프론트는 상대시간 표시 |
| content | reason_detail | 매핑됨 | 필드명 다름 |
| orderNo | - | **ERD 누락** | 관련 주문번호 FK |
| reporter.type | reporter_type | 값 불일치 | USER↔CUSTOMER |
| reporter.name | reporter_id → users.name | 조인 필요 | |
| reporter.contact | reporter_id → users.phone | 조인 필요 | |
| reported.type | target_type | 매핑됨 | |
| reported.name | target_id → 대상 테이블.name | 다형성 조인 | |
| resolution | admin_note | 매핑됨 | 필드명 다름 |

### 1.4 이슈

#### 이슈 1: `report_type` (신고 유형) 누락

프론트엔드에서 `배송지연`, `상품불량`, `불친절`, `정산문제` 등 유형 구분을 사용하지만 ERD에는 `reason_detail` 텍스트만 있고 분류 ENUM이 없음.

**권장**: `report_type` ENUM 컬럼 추가

```sql
report_type ENUM('DELIVERY_DELAY', 'DEFECTIVE_PRODUCT', 'RUDENESS',
                 'SETTLEMENT_ISSUE', 'OTHER') NOT NULL
```

#### 이슈 2: 주문 연결 (`order_id`) 누락

프론트에서 `orderNo`로 관련 주문을 표시하지만 ERD에 주문 연결 FK가 없음.

**권장**: `order_id` (FK → orders, Nullable) 추가

#### 이슈 3: `reporter_id` 다형성 FK 설계

현재 `reporter_id`가 users/stores/riders 중 하나를 가리키는 다형성 FK 구조로, DB 레벨에서 참조 무결성 제약을 걸 수 없음.

| 대안 | 설명 | 장점 | 단점 |
|------|------|------|------|
| **A. users.user_id로 통일** | reporter_id를 항상 users.user_id로 참조 (stores/riders도 user_id 보유) | FK 제약 가능, 단순 | reporter_type 불필요해질 수 있음 |
| **B. 현재 구조 유지** | reporter_type + reporter_id 다형성 유지 | 유연성 | FK 제약 불가, 앱 레벨 검증 필요 |
| **C. FK 3개 분리** | reporter_user_id, reporter_store_id, reporter_rider_id (NULL 허용) | 명시적 FK | 컬럼 수 증가, NULL 관리 |

### 1.5 상태값 체계 비교

| ERD 상태 | 프론트 표시 | 설명 |
|---------|-----------|------|
| PENDING | 확인 중 | 신규 접수, 미처리 |
| PROCESSING | 처리 중 | 관리자 검토 진행 |
| RESOLVED | 처리완료 | 조치 완료 |
| DISMISSED | 기각 | 프론트 미사용 (추가 필요) |

---

## 2. 승인 관리 테이블

### 2.1 현재 ERD 구조 (3개 테이블)

```
approval_documents              store_approvals              rider_approvals
├── document_id (PK)            ├── approval_id (PK)         ├── approval_id (PK)
├── applicant_type (STORE/RIDER)├── store_id (FK)            ├── rider_id (FK)
├── store_id (FK, Nullable)     ├── status                   ├── status
├── rider_id (FK, Nullable)     ├── reason                   ├── reason
├── document_type               ├── approved_by (FK)         ├── approved_by (FK)
├── document_url                ├── approved_at              ├── approved_at
├── created_at                  ├── created_at               ├── created_at
└── updated_at                  └── updated_at               └── updated_at
```

### 2.2 프론트엔드 실제 사용 구조 (AdminDashboard.jsx)

```javascript
{
  id: 1,
  type: '마트',                        // applicant_type
  name: '싱싱 야채 센터 (강북점)',
  date: '2026-01-21',                  // created_at
  status: '심사 대기',                  // approval status
  category: 'STORE',                   // STORE or RIDER
  formData: {
    // 마트 신청용
    businessRegistrationFile: 'business_reg_2026.pdf',  // BUSINESS_LICENSE
    mailOrderFile: 'mail_order_cert.pdf',               // BUSINESS_REPORT
    bankbookFile: 'bankbook_copy.pdf',                  // BANK_PASSBOOK
    // 라이더 신청용
    identityFile: 'id_card.png',                        // ID_CARD
    licenseFile: 'license_pcx.jpg',                     // 운전면허증
  }
}
```

### 2.3 필드 매핑 비교

| 프론트 필드 | ERD 테이블.컬럼 | 상태 | 비고 |
|-----------|---------------|------|------|
| id | store_approvals.approval_id / rider_approvals.approval_id | 매핑됨 | |
| category | applicant_type | 매핑됨 | STORE/RIDER |
| status | store_approvals.status / rider_approvals.status | 값 불일치 | 아래 상세 |
| date | created_at | 매핑됨 | |
| formData.businessRegistrationFile | approval_documents.document_url (type=BUSINESS_LICENSE) | 구조 차이 | 프론트는 인라인, DB는 별도 테이블 |
| formData.mailOrderFile | approval_documents.document_url (type=BUSINESS_REPORT) | 구조 차이 | |
| formData.bankbookFile | approval_documents.document_url (type=BANK_PASSBOOK) | 구조 차이 | |
| formData.identityFile | approval_documents.document_url (type=ID_CARD) | 구조 차이 | |

### 2.4 이슈

#### 이슈 1: `store_approvals`와 `rider_approvals` 분리 vs 통합

두 테이블의 구조가 동일함 (status, reason, approved_by, approved_at). 프론트에서도 하나의 `approvalItems` 배열로 `category`로 구분.

| 대안 | 설명 | 장점 | 단점 |
|------|------|------|------|
| **A. 통합 (approvals)** | 단일 테이블 + applicant_type ENUM + applicant_id | 프론트와 일치, 코드 단순화, 조회 쉬움 | 마트/라이더별 확장 시 컬럼 추가 |
| **B. 분리 유지** | store_approvals / rider_approvals 별도 유지 | 향후 마트/라이더별 독자 필드 확장 용이 | 프론트 UNION 조회 필요, 중복 로직 |

#### 이슈 2: `approval_documents`의 다형성 FK

`store_id`와 `rider_id` 중 하나만 값이 있고 나머지는 NULL인 구조.

| 대안 | 설명 | 장점 | 단점 |
|------|------|------|------|
| **A. applicant_id 단일화** | applicant_type + applicant_id 단일 컬럼 | 단순, 확장 용이 | FK 제약 불가 |
| **B. 현재 유지** | store_id / rider_id 분리 | 각각 FK 제약 가능 | NULL 관리, CHECK 제약 필요 |

#### 이슈 3: 승인 상태 흐름 불일치

ERD와 프론트엔드의 상태 세분화 수준이 다름.

| ERD 상태 | 프론트 표시 | 설명 |
|---------|-----------|------|
| PENDING | 심사 대기 | 신규 접수 |
| - | 서류 확인 | **ERD에 없음** - 서류 검토 중 |
| - | 서류 미비 | **ERD에 없음** - 보완 요청 |
| - | 검토 중 | **ERD에 없음** - 최종 검토 |
| APPROVED | 승인완료 | 승인 처리 |
| REJECTED | 반려 | 반려 처리 |
| HELD | 보류 | 보류 처리 |

**권장**: ERD에 `DOCUMENT_REVIEW`, `DOCUMENT_INCOMPLETE` 상태 추가 검토

```sql
status ENUM('PENDING', 'DOCUMENT_REVIEW', 'DOCUMENT_INCOMPLETE',
            'REVIEWING', 'APPROVED', 'REJECTED', 'HELD')
```

---

## 3. 종합 권장사항

### 3.1 reports 테이블 수정 권장

| # | 항목 | 권장 내용 |
|---|------|---------|
| 1 | report_type 추가 | ENUM(DELIVERY_DELAY, DEFECTIVE_PRODUCT, RUDENESS, SETTLEMENT_ISSUE, OTHER) |
| 2 | order_id FK 추가 | FK → orders (Nullable), 신고와 주문 연결 |
| 3 | reporter_id 설계 | users.user_id로 통일 권장 (stores/riders 모두 user_id 보유) |

### 3.2 승인 테이블 수정 권장

| # | 항목 | 권장 내용 |
|---|------|---------|
| 1 | approvals 통합 검토 | store_approvals + rider_approvals → approvals 단일 테이블 + applicant_type |
| 2 | 상태값 세분화 | DOCUMENT_REVIEW, DOCUMENT_INCOMPLETE 상태 추가 |
| 3 | approval_documents FK | applicant_type + applicant_id 방식 또는 현재 구조 유지 (팀 합의 필요) |
